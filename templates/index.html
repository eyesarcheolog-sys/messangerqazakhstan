<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body data-username="{{ current_user.username }}">
    
    <div id="sidebar">
        <div id="user-info">
            <h2>{{ current_user.username }}</h2>
            <a href="{{ url_for('logout') }}">–í—ã–π—Ç–∏</a>
        </div>

        <div id="create-group-btn">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</div>

        <div class="chat-list-container">
            <div class="list-header">–ì—Ä—É–ø–ø—ã</div>
            <ul class="chat-list" id="group-list">
                {% for group in groups %}
                <li data-type="group" data-id="{{ group.id }}" data-name="{{ group.name }}">
                    <div class="chat-avatar">{{ group.name[0] | upper }}</div>
                    <div class="chat-info">
                        <div class="chat-name">{{ group.name }}</div>
                    </div>
                    <div class="chat-meta">
                        <div class="notification-dot" id="notif-group-{{ group.id }}">0</div>
                    </div>
                </li>
                {% endfor %}
            </ul>
            
            <div class="list-header">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
            <ul class="chat-list" id="contact-list">
                {% for user in users %}
                    {% if user.id != current_user.id %}
                    <li data-type="user" data-id="{{ user.id }}" data-name="{{ user.username }}">
                        <div class="chat-avatar user-avatar">
                            {{ user.username[0] | upper }}
                            <div class="online-indicator" id="status-{{ user.username }}"></div>
                        </div>
                        <div class="chat-info">
                            <div class="chat-name">{{ user.username }}</div>
                        </div>
                        <div class="chat-meta">
                           <div class="notification-dot" id="notif-{{ user.username }}">0</div>
                        </div>
                    </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>

    <div id="chat-container">
        <div id="chat-header">
            <button id="chat-header-back-btn" style="display: none;">&larr;</button>
            <h2><a href="#" id="chat-header-link">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</a></h2>
        </div>
        
        <ul id="messages"></ul>

        <form id="form" action="">
            <input id="input" autocomplete="off" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
            <button id="assistant-btn" type="button" title="–ò–ò-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç" aria-label="–ò–ò –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç">‚ú®</button>
            <button id="record-btn" type="button" aria-label="–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">üé§</button>
            <button id="send-btn" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    </div>

    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É</h2>
            <form action="{{ url_for('create_group') }}" method="POST">
                <div>
                    <label for="group_name">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã:</label>
                    <input type="text" id="group_name" name="group_name" required>
                </div>
                <div>
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</label>
                    <div class="members-list">
                        {% for user in users %}
                            {% if user.id != current_user.id %}
                            <div>
                                <input type="checkbox" name="members" value="{{ user.id }}" id="user-{{ user.id }}">
                                <label for="user-{{ user.id }}">{{ user.username }}</label>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <div id="voice-modal" class="voice-modal-overlay">
         <div class="voice-modal-content">
            <h2>–ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
            <div id="voice-status">–ù–∞–∂–º–∏—Ç–µ '–°—Ç–∞—Ä—Ç' –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏</div>
            <div id="audio-playback-container">
                <audio id="audio-playback" controls></audio>
            </div>
            <div id="transcription-container">
                <textarea id="transcription-text" placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è..."></textarea>
            </div>
            <div class="voice-modal-controls">
                <button id="start-record-btn">–°—Ç–∞—Ä—Ç</button>
                <button id="stop-record-btn" style="display: none;">–°—Ç–æ–ø</button>
                <select id="ai-model-select" style="display: none;">
                    <option value="gemini">Gemini</option>
                    <option value="deepseek">DeepSeek</option>
                </select>
                <button id="improve-ai-btn" style="display: none;">–£–ª—É—á—à–∏—Ç—å</button>
                <button id="generate-ai-btn" style="display: none;">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div class="voice-modal-actions">
                <button id="delete-record-btn">–û—Ç–º–µ–Ω–∞</button>
                <button id="send-audio-btn" style="display: none;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞—É–¥–∏–æ</button>
                <button id="send-text-btn" style="display: none;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
            </div>
        </div>
    </div>

    <div id="assistant-modal" class="voice-modal-overlay">
        <div class="voice-modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                 <h2>–ò–ò-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</h2>
                 <span class="close-btn" id="close-assistant-btn" style="cursor: pointer; font-size: 28px;">&times;</span>
            </div>
            <div id="assistant-messages"></div>
            <form id="assistant-form">
                <input id="assistant-input" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å —É –ò–ò..." autocomplete="off">
                <button id="assistant-send-btn" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
            <button id="send-to-chat-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –≤ —á–∞—Ç</button>
        </div>
    </div>
    
    <div id="initial-data" data-unread-counts='{{ unread_counts | tojson | safe }}'></div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>