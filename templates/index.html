<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body data-username="{{ current_user.username }}">
    <div id="sidebar">
        <div id="user-info">
            <h2>{{ current_user.username }}</h2>
            <a href="{{ url_for('logout') }}">–í—ã–π—Ç–∏</a>
        </div>
        
        <div class="chat-list-container">
            <div class="list-header">–ì—Ä—É–ø–ø—ã</div>
            <ul id="group-list" class="chat-list">
                {% for group in groups %}
                    <li data-id="{{ group.id }}" data-type="group" data-name="{{ group.name }}">
                        <div class="chat-avatar">#</div>
                        <div class="chat-info">
                            <div class="chat-name">{{ group.name }}</div>
                            <div class="chat-preview">–°–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ...</div>
                        </div>
                        <div class="chat-meta">
                            <div class="chat-time"></div>
                            <span class="notification-dot" id="notif-group-{{ group.id }}"></span>
                        </div>
                    </li>
                {% endfor %}
            </ul>

            <div class="list-header">–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</div>
            <ul id="contact-list" class="chat-list">
                {% for user in users %}
                    {% if user.id != current_user.id %}
                        <li data-id="{{ user.id }}" data-type="user" data-name="{{ user.username }}">
                            <div class="chat-avatar user-avatar">
                                {{ user.username[0] | upper }}
                                <span class="online-indicator" id="status-{{ user.username }}"></span>
                            </div>
                            <div class="chat-info">
                                <div class="chat-name">{{ user.username }}</div>
                                <div class="chat-preview">–õ–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...</div>
                            </div>
                            <div class="chat-meta">
                                <div class="chat-time"></div>
                                <span class="notification-dot" id="notif-{{ user.username }}"></span>
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
        
        <div id="create-group-btn">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</div>
    </div>

    <div id="chat-container">
        <div id="chat-header">
            <button id="chat-header-back-btn">&larr;</button>
            <h2 style="margin: 0;"><a id="chat-header-link" href="#">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</a></h2>
        </div>
        <ul id="messages"></ul>
        <form id="form" action="">
            <input id="input" autocomplete="off" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
            <button id="assistant-btn" type="button" title="–ò–ò-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç">‚ú®</button>
            <button id="record-btn" type="button">üé§</button>
            <button id="send-btn" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    </div>

    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≥—Ä—É–ø–ø—ã</h2>
            <form action="/create_group" method="POST">
                <input type="text" name="group_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" required>
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</h4>
                <div class="members-list">
                    {% for user in users %}
                        {% if user.id != current_user.id %}
                        <div>
                            <input type="checkbox" name="members" value="{{ user.id }}" id="user-{{ user.id }}">
                            <label for="user-{{ user.id }}">{{ user.username }}</label>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <button type="submit" style="margin-top: 20px; width: 100%; padding: 10px; background-color: var(--notification-badge-color); color: white; border: none; border-radius: 5px;">–°–æ–∑–¥–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <div id="voice-modal" class="voice-modal-overlay">
        <div class="voice-modal-content">
            <h2 id="voice-modal-title">–ó–∞–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
            <div id="voice-status">–ù–∞–∂–º–∏—Ç–µ "–°—Ç–∞—Ä—Ç" –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏</div>
            <div id="audio-playback-container"><audio id="audio-playback" controls></audio></div>
            <div id="transcription-container"><textarea id="transcription-text" placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è..."></textarea></div>
            <div class="voice-modal-controls">
                <button id="start-record-btn">–°—Ç–∞—Ä—Ç</button>
                <button id="stop-record-btn" style="display:none;">–°—Ç–æ–ø</button>
                <select id="ai-model-select" style="display:none;">
                    <option value="gemini">Gemini</option>
                    <option value="deepseek">DeepSeek</option>
                </select>
                <button id="improve-ai-btn" style="display:none;">–£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç ‚úçÔ∏è</button>
                <button id="generate-ai-btn" style="display:none;">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç ü§ñ</button>
            </div>
            <div class="voice-modal-actions">
                <button id="delete-record-btn">–û—Ç–º–µ–Ω–∞</button>
                <button id="send-text-btn" style="display:none;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
                <button id="send-audio-btn" style="display:none;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞—É–¥–∏–æ</button>
            </div>
        </div>
    </div>

    <div id="assistant-modal" class="voice-modal-overlay">
        <div class="voice-modal-content">
            <h2>–ò–ò-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</h2>
            <div id="assistant-messages">
                <div class="assistant-bubble assistant">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?</div>
            </div>
            <form id="assistant-form">
                <input id="assistant-input" autocomplete="off" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å..." />
                <button id="assistant-send-btn" type="submit">‚û¢</button>
            </form>
            <button id="send-to-chat-btn" class="voice-modal-actions">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç –≤ —á–∞—Ç</button>
            <button id="close-assistant-btn" class="voice-modal-actions">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    
    <div id="initial-data" data-unread-counts='{{ unread_counts | tojson | safe }}'></div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>